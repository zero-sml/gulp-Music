[toc]
打开方式：使用终端用gulp打开
## 1：技术栈：
html+css+javascript+构建工具 gulp

## 2:功能：
- 中间是图片，由歌曲决定，从数据请求拿到，歌曲播放的时候，图片会转动
- 背景图也是这张图片，用高斯模糊实现
- 歌曲信息：歌名，作者，相关信息
- 进度条：
  - 左边时间，通过歌曲播放增加
  - 进度条，可以拖拽
  - 右边是总时间，通过歌曲播放时间减少，切割会变化
- 歌曲控制：心形，上一首，播放/停止，下一首，列表（播放列表，所有的歌曲，关闭）

### 模块化开发
- 渲染模块：歌曲信息
- 高斯模糊：背景
- 音乐模块：歌曲控制
- 索引模块：当前歌曲对应的索引，与列表的歌曲保持一致
- 列表切切歌模块：展开，收缩，切歌
- 进度条模块
- 整体逻辑控制模块

## 3：准备工作：
- gulp创建4个任务以及安装需要的插件进行压缩，清理无效的代码；任务结束后开启服务器的热更新
  - html--> gulp-htmlclean
  - css-->gulp-less,gulp-clean-css
  - js-->gulp-strip-debug,gulp-uglify
  - image-->gulp-imagemin
  - server-->gulp-connect

热更新（server）需要配合文件监听一起使用才会有效果；接着用服务器的reload方法监听html,css,js变化


## 具体过程
- 渲染模块（render）
   内容：渲染图片，音乐信息，是否喜欢
   方式：获取data.json的数据，通过不同的函数得到同板块的数据

- 音乐模块(audio)
   内容：上一首，下一首，播放/暂停
   方式：获取它们的index，进行摁下操作，并且摁下上一首或下一首是自动播放状态；
        播放当音乐播放时，点击后，按钮变为停止，音乐暂停，图片停止旋转，图标转变；
        当音乐暂停时，点击后，按钮变为播放，音乐继续播放，图片按照之前的角度继续旋转

- 索引模块(indexControl)
  内容：获取音乐的索引
  方式：用3个方法表示上一首，下一首，以及获取索引

- 列表切歌模块(listControl)
   内容：
   方式：创建结构;点击时设置列表的出现和隐藏;

- 进度条模块(progress)
  内容：进度条，拖拽
  方式：获取歌曲总时间，设置定时器，开始时间，进度条停止距离
  进度条：把开始时间设置成00：00格式，进度条移动的时候：先清除定时器，使用时间戳记录当前的时间，用百分比记录移动的距离；判断百分比是否超过1，没有就更新进度条移动的距离，更新走的时间，更新小圆点移动的距离，否则就清除定时器

  遇到的问题：
  （1）点击暂停后播放在暂停在播放，进度条没有从最新的的距离开始计算，从记录第一次的距离开始计算
  --> 将lastTime += 之前的百分比;然后赋值给per计算百分比

  （2）切歌的时候，进度条没有从头开始播放
  -->加载音乐的时候，调用进度条move的方法

  （3）切歌后，时间不是从0开始，是从上一首歌记录的数字开始
  --> 在开启定时器之前，清除上一次的记录

   拖拽功能：获取拖拽的元素，摁下拖拽时的坐标，获得拖拽的距离，拖拽的百分比；拖拽：记录第一根摁下的手指，离左边的距离，暴露对外的方法；拖拽开始移动：得到移动的距离，判断它拖拽的距离是否在小圆点之间，获得它的百分比，阻止默认事件；拖拽结束，暴露事件

  （4）按了暂停后切歌，进度条没有重新回到起点，按之前的距离开始增长
  -->给move方法传入一个参数，lastTime判断参数是否为undefined，如果是那么per就加上lastTime否则就是参数的值


- 整体逻辑控制板块(index)
   内容：面向对象方法，进行样式初始化
   方式：在原型上创建多个函数
   1.获取页面元素(getDom)；
   2.获取数据(getData)，用Zepto里面的Ajax请求数据，请求成功时；存储请求过来的数据，调用`列表切歌，获取音乐的索引，加载音乐，控制音乐的操作功能，进度条的拖拽`
   3.加载音乐(loadMusic)：获取音乐的图片，音乐信息，视频加载的路径，控制图片旋转角度
   4.控制音乐(musicControl)：实现上一首，播放/暂停，下一首的功能
   5.播放音乐旋转图片(imgRotate)：用定时器设置旋转的角度；关闭定时器用于点击暂停时设置图片停止旋转
   6.播放列表的控制(listPlay)：点击列表按钮时，使图片出现;接着遍历列表，获得点击item的index让此index的歌曲加载并且播放，点击后让列表消失
   7.进度条(dragProgress)：获取小圆点，并且实例化进度条的方法；摁下按钮时获取进度条的stop方法；拖动进度条的时候更新进度条的百分比；抬起手指时，获取当前时间，让音乐播放，图片旋转，按钮变为播放
